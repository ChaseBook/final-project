---
title: "Draft Exploration"
author: "Chase Bookin"
date: "March 21, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidycensus)
library(ggthemes)
library(ggplot2)
library(janitor)
library(dplyr)
library(gt)
library(readxl)
library(sf)
library(scales)
library(magrittr)
library(haven)
library(infer)
library(Lahman)
library(xml2)
library(rvest)
library(DataCombine)
```


```{r, include=FALSE}
draft <- read_csv("data/draft_register.csv") %>%
  clean_names()

angels <- data.frame(a = c("Anahaim Angels", "Los Angeles Angels of Anaheim", "California Angels"))

replace_angels <- data.frame(from = c("Anahaim Angels",
                                      "Los Angeles Angels of Anaheim",
                                      "California Angels"), 
                             to = c("Los Angeles Angels"))

draft <- FindReplace(data = draft, "teamname", replaceData = replace_angels,
                     from = "from", to = "to", exact = FALSE)

draft <- draft %>%
  mutate(teamname == ifelse(teamname == "Anahaim Angels", "Los Angeles Angels",
                            ifelse(teamname == "California Angels", "Los Angeles Angels",
                                   ifelse(teamname == "Los Angeles Angels of Anaheim", "Los Angeles Angels",
                                          teamname))))
```



```{r, echo=FALSE}
draft_2000_2012 <- draft %>%
  filter(year >= 2000 & year <= 2012)

draft_2000_2012 <- draft_2000_2012 %>%
  mutate(mlb_made = ifelse(high_level == "MLB", 1, 0)) %>%
  mutate(ignore = 1) %>%
  group_by(draft_round) %>%
  summarize(percent_mlb = sum(mlb_made) / sum(ignore))

ggplot(draft_2000_2012, mapping = aes(draft_round, percent_mlb)) +
  geom_col() +
  theme_economist_white() +
  labs(
    x = "Draft Round",
    y = "Percent to reach Major Leagues",
    title = "Percent of Draft Picks by Round to Reach the Majors",
    subtitle = "Data from 2000-2012 drafts"
  )
```

```{r, echo=FALSE}
grow_talent <- draft %>%
  filter(source == "H" & signed == "Y") %>%
  mutate(decade = ifelse(year %in% 1970:1979, 1970,
                                 ifelse(year %in% 1980:1989, 1980,
                                        ifelse(year %in% 1990:1999, 1990,
                                               ifelse(year %in% 2000:2009, 2000,
                                                      ifelse(year %in% 2010:2019, 2010, NA)))))) %>%
  filter(year >= 1980 & year <= 2009) %>%
  mutate(mlb_made = ifelse(high_level == "MLB", 1, 0)) %>%
  mutate(ignore = 1) %>%
  filter(teamname != "Los Angeles Angels of Anaheim") %>%
  group_by(teamname) %>%
  summarize(percent_mlb = sum(mlb_made) / sum(ignore))

ggplot(grow_talent, mapping = aes(x = reorder(teamname, -percent_mlb), percent_mlb)) +
  geom_col() +
  theme_economist_white() +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(
    x = "Team",
    y = "Percent of High School Picks to MLB",
    title = "Percent of High School Picks to MLB by Team",
    subtitle = "Data: 1980-2009 Drafts"
  )
  
```











